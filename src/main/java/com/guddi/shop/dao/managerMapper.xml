<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC	"-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>

<mapper namespace="com.guddi.shop.dao.ManagerDao">

	<!-- 관리자 제품내역 관련 Ryujihong 2022.01.12 Start -->
	<select id="getBrandcategory" resultType="com.guddi.shop.dto.EtcDto">
		select brand_idx, brand_name, brand_code  from brand where use_flg = 1
	</select>
	
	<select id="getBagtype" resultType="com.guddi.shop.dto.EtcDto">
		select type_idx , type_name, type_code  from bagtype where use_flg = 1
	</select>
	
	<select id="getSellflg" resultType="com.guddi.shop.dto.EtcDto">
		select idx, sellname  from sellflg where use_flg = 1
	</select>
	
	<select id="getAnswertype" resultType="com.guddi.shop.dto.EtcDto">
		select idx, answername from answertype where use_flg = 1
	</select>
	
	<select id="getNewflg" resultType="com.guddi.shop.dto.EtcDto">
		select idx, newname  from newflg where use_flg = 1
	</select>	
	
	<select id="productInfo" resultType="com.guddi.shop.dto.ProductDto">
		select idx, brand_name, bag_type, product_name, product_code, product_content
		, price, new_flg, sell_flg, brand_idx from product where idx = #{idx}
	</select>
	
	<select id="productImageInfo" resultType="com.guddi.shop.dto.ProductDto">
		select p_idx, b_idx, oriFileName,newFileName, photo_num from product_photo
		where b_idx = #{idx}
		order by photo_num asc
	</select>
	
	<select id="getNewIdx" resultType="String">
		SELECT idx FROM product WHERE idx = (SELECT max(idx) FROM product)
	</select>
	
	<!-- 관리자페이지 제품리스트 총 갯수 + 검색 적용 -->
	<select id="productSearchCount" parameterType="com.guddi.shop.dto.PageDto" resultType="int">
 	select count(*) from product
 	where 1=1
	<if test='brand_name!= null'>
  	and brand_name LIKE concat('%', #{brand_type}, '%') 
 	</if>	
 	<if test='bag_name!= null'>
  	and bag_type LIKE concat('%', #{bag_type}, '%') 
 	</if>	
 	<if test='keyword != null'>
  	and product_name LIKE concat('%', #{keyword}, '%')
 	</if>  	
	</select>
	
	<!-- 관리자페이지 제품정보 리스트 -->
	<select id="productList" parameterType="com.guddi.shop.dto.PageDto" resultType="com.guddi.shop.dto.ProductDto">
 	select idx, brand_name, bag_type, product_name, product_code, price, new_flg, sell_flg, regdate from product
 	where 1=1
	<if test='brand_name!= null'>
  	and brand_name LIKE concat('%', #{brand_name}, '%') 
 	</if>	
 	<if test='bag_name!= null'>
  	and bag_type LIKE concat('%', #{bag_name}, '%') 
 	</if>	
 	<if test='keyword != null'>
  	and product_name LIKE concat('%', #{keyword}, '%')  	
 	</if>  	
 	order by idx desc
 	limit #{displayPost}, #{postNum}
	</select>
	<!-- 관리자 제품내역 관련 Ryujihong 2022.01.12 End -->
	<!-- 관리자 제품 정보 수정 관련 Ryujihong 2022.01.12 Start -->
	<update id="doUpdateProduct">
		UPDATE product SET product_name = #{product_name}, brand_name = #{brand_name}, bag_type=#{bag_type} 
		, sell_flg = #{sell_flg}, new_flg = #{new_flg}, product_code = #{product_code}, product_content =#{product_content} 
		,price = #{price} WHERE idx = #{idx}
	</update>
	<!-- 관리자 제품 정보 수정 관련 Ryujihong 2022.01.12 End -->
	
	<!--관리자페이지 제품등록 Start ryujihong 2022.01.14 -->
	<select id="getU_idx" resultType="int">
		select idx from member where userId = #{userId}
	</select>
	
	<insert id="doRegistProduct" 
		useGeneratedKeys="true"
		keyProperty="idx"
		keyColumn="idx"
		parameterType="com.guddi.shop.dto.ProductDto">
		
		insert into product (brand_name, bag_type, product_name, product_code, product_content, price, new_flg, sell_flg, brand_idx, del_flg, u_idx) 
		values (#{brand_name}, #{bag_type}, #{product_name}, #{product_code}, #{product_content}, #{price}, #{new_flg}, #{sell_flg}, #{brand_idx}, 0, #{u_idx})
	</insert>
	
	<insert id="doRegistPhoto" parameterType="com.guddi.shop.dto.ProductDto">
		insert into product_photo (newFileName, oriFileName , b_idx, photo_num, u_idx) 
		values (#{newFileName}, #{oriFileName}, #{b_idx}, #{photo_num}, #{u_idx})
	</insert>
	<!-- 관리자페이지 제품등록 End ryujihong 2022.01.14 -->
	

</mapper>